components:
  schemas:
    PcieDevice:
      description: DocRef(PcieDeviceEntityDesc)
      allOf:
        - $ref: ModelRef({ext:common:/namespaces/common/versioned/v1/modules/response/beta/models/ExternalizableAbstractModel})
        - type: "object"
          properties:
            # Device positioning. Generated by AHV.
            clusterExtId:
              description: DocRef(ClusterUuidDesc)
              readOnly: true
              type: "string"
              x-constraints:
                pattern: "ConstantRef({ext:common:/namespaces/common}, uuidPattern)"
            hostExtId:
              description: DocRef(PcieDeviceHostDesc)
              readOnly: true
              type: "string"
              x-constraints:
                pattern: "ConstantRef({ext:common:/namespaces/common}, uuidPattern)"
            # Device state. Owned by AHV.
            state:
              description: DocRef(PcieDeviceStateDesc)
              readOnly: true
              $ref: ModelRef({./PcieDeviceState})
            # Device human-readable description.
            description:
              description: DocRef(PcieDeviceDescriptionDesc)
              readOnly: true
              type: "string"
              x-constraint:
                maxLength: ConstantRef(maxPcieDeviceDescriptionLength)
            configuration:
              description: DocRef(PcieDeviceConfigurationDesc)
              readOnly: true
              $ref: ModelRef({./PcieDeviceConfiguration})
            ownerVmExtId:
              description: DocRef(PcieDeviceOwnerDesc)
              readOnly: true
              type: "string"
              x-constraints:
                pattern: "ConstantRef({ext:common:/namespaces/common}, uuidPattern)"
      x-property-mapping:
        - name: "clusterExtId"
          value: "_master_cluster_uuid_"
        - name: "hostExtId"
          value: "host_uuid"
        - name: "extId"
          value: "label_uuid"
        # Other fields: state, description are named as is in IDF.
      x-codegen-hint:
        $any:
          - type: entity-identifier
            properties:
              identifiers:
                - type: "ModelRef({ext:common:/namespaces/common/versioned/v1/modules/response/beta/models/ExternalizableAbstractModel})"
                  name: base
                  index: 2001
                - name: clusterExtId
                  index: 2002
                - name: hostExtId
                  index: 2003
                - name: extId
                  index: 2004
                - name: state
                  index: 2005
                - name: description
                  index: 2006
                - name: configuration
                  index: 2007
                - name: ownerVmExtId
                  index: 2008

      x-filterable-properties:
        - clusterExtId
        - hostExtId
        - extId
        - configuration
        - state
        - ownerVmExtId
      x-selection-properties:
        - clusterExtId
        - hostExtId
        - extId
        - configuration
        - state
        - ownerVmExtId

    PcieDeviceState:
      description: DocRef(PcieDeviceStateDesc)
      allOf:
        - $ref: "ModelRef({ext:common:/namespaces/common/versioned/v1/modules/config/beta/models/BaseEnum})"
        - type: "string"
          enum:
            - UVM_AVAILABLE
            - UVM_RESERVED
            - UVM_ASSIGNED
            - HOST_BROKEN
            - HOST_UNUSED
      x-codegen-hint:
        $any:
          - type: entity-identifier
            properties:
              identifiers:
                - value: UVM_AVAILABLE
                  index: 2001
                - value: UVM_RESERVED
                  index: 2002
                - value: UVM_ASSIGNED
                  index: 2003
                - value: HOST_BROKEN
                  index: 2004
                - value: HOST_UNUSED
                  index: 2005
              descriptions:
                - name: 'UVM_AVAILABLE'
                  description: DocRef(PcieDeviceStateUvmAvailableDesc)
                - name: 'UVM_RESERVED'
                  description: DocRef(PcieDeviceStateUvmReservedDesc)
                - name: 'UVM_ASSIGNED'
                  description: DocRef(PcieDeviceStateUvmAssignedDesc)
                - name: 'HOST_BROKEN'
                  description: DocRef(PcieDeviceStateHostBrokenDesc)
                - name: 'HOST_UNUSED'
                  description: DocRef(PcieDeviceStateHostUnusedDesc)
      x-property-mapping:
        - name: UVM_AVAILABLE
          value: 1
        - name: UVM_RESERVED
          value: 2
        - name: UVM_ASSIGNED
          value: 3
        - name: HOST_BROKEN
          value: 4
        - name: HOST_UNUSED
          value: 5

    PcieDeviceConfiguration:
      description: DocRef(PcieDeviceConfigurationDesc)
      type: object
      properties:
        vendorId:
          description: DocRef(PcieDeviceVendorIdDesc)
          readOnly: true
          type: "integer"
          format: "int64"
        deviceId:
          description: DocRef(PcieDeviceDeviceIdDesc)
          readOnly: true
          type: "integer"
          format: "int64"
        subSystemVendorId:
          description: DocRef(PcieDeviceSubSystemVendorIdDesc)
          readOnly: true
          type: "integer"
          format: "int64"
        subSystemId:
          description: DocRef(PcieDeviceSubSystemIdDesc)
          readOnly: true
          type: "integer"
          format: "int64"
        classId:
          description: DocRef(PcieDeviceClassIdDesc)
          readOnly: true
          type: "integer"
          format: "int64"
        subClassId:
          description: DocRef(PcieDeviceSubSystemClassIdDesc)
          readOnly: true
          type: "integer"
          format: "int64"
        progIFace:
          description: DocRef(PcieDeviceProgIFaceDesc)
          readOnly: true
          type: "integer"
          format: "int64"
      x-property-mapping:
        - name: "vendorId"
          value: "vendor_id"
        - name: "deviceId"
          value: "device_id"
        - name: "subSystemId"
          value: "subsystem_id"
        - name: "subSystemVendorId"
          value: "subsystem_vendor_id"
        - name: "classId"
          value: "class_id"
        - name: "subClassId"
          value: "sub_class_id"
        - name: "progIFace"
          value: "prog_iface"
      x-codegen-hint:
        $any:
          - type: entity-identifier
            properties:
              identifiers:
                - name: vendorId
                  index: 2001
                - name: deviceId
                  index: 2002
                - name: subSystemVendorId
                  index: 2003
                - name: subSystemId
                  index: 2004
                - name: classId
                  index: 2005
                - name: subClassId
                  index: 2006
                - name: progIFace
                  index: 2007
      x-complex-type-edm: true
      x-filterable-properties:
        - vendorId
        - deviceId
        - subSystemVendorId
        - subSystemId
        - classId
        - subClassId
        - progIFace
      x-selection-properties:
        - vendorId
        - deviceId
        - subSystemVendorId
        - subSystemId
        - classId
        - subClassId
        - progIFace

